
@{
    ViewBag.Title = "确认单统计";
}

@section PageTitle{
    确认单交易统计 <div class="text-center f-s-18">当前成交总金额：<strong class="text-danger">107,221,197.50</strong> 元</div>
}

@section header{
    @Styles.Render("~/Content/datatables/css/jquery.dataTables.css")
    @Styles.Render("~/Content/themes/sean/css/datepicker3.css")
}

<div class="row">
    <!-- begin col-12 -->
    <div class="col-md-12 ui-sortable">

        <ul class="nav nav-tabs">
            <li class="active" val="chart"><a href="#boardmap" data-toggle="tab"><i class="fa fa-map-marker"></i> 确认单交易统计视图</a></li>
            <li val="list" class=""><a href="#boardlist" data-toggle="tab"><i class="fa fa-windows"></i> 确认单交易统计列表</a></li>
        </ul>
        <div class="tab-content">
            
                <div class="row">
                    <div id="city-agent-containner" class="col-md-6">

                    </div>
                    @*<div class="col-md-2 ui-sortable">
                        <select class="form-control" data-val="true" data-val-number="The field AgentId must be a number." id="AgentId" name="AgentId">
                            <option value="">选择一个代理商</option>
                            <option style="display:none" value="21">成都谦博文化传播有限公司</option>
                            <option value="19">成都公交传媒公益广告中心</option>
                            <option value="18">成都金瑞杰广告有限公司</option>
                            <option value="20">成都广来贝广告有限公司</option>
                            <option value="25">成都鑫时空广告有限公司</option>
                            <option value="42">成都蜀洲新越文化传播有限公司</option>
                            <option value="14">成都网泰文化传媒有限公司</option>
                        </select>
                    </div>
                    <div class="col-sm-2 ui-sortable">
                        <select class="form-control" data-val="true" data-val-number="The field UserId must be a number." id="UserId" name="UserId">
                            <option value="">选择一个销售</option>
                            <option value="24">徐志</option>
                            <option value="25">孙小海</option>
                            <option value="26">刘超</option>
                            <option value="30">陈章</option>
                            <option value="31">欧国丰</option>
                            <option value="35">吴建</option>
                            <option value="36">冯丽君</option>
                            <option value="38">张洧源</option>
                            <option value="44">张志</option>
                            <option value="49">李桂清</option>
                            <option value="52">傅思棋</option>
                            <option value="56">昝欣言</option>
                            <option value="70">王建</option>
                            <option value="110">吴懿</option>
                            <option value="136">广来贝媒介</option>
                            <option value="139">孙瑜</option>
                            <option value="142">何薇</option>
                            <option value="143">马军明</option>
                            <option value="149">许莉红</option>
                            <option value="168">胡辛晨</option>
                            <option value="181">张乐懿</option>
                            <option value="182">胡亮</option>
                            <option value="183">李蕊尾</option>
                            <option value="189">唐振宇</option>
                            <option value="219">黄泽丽</option>
                            <option value="225">倪瑞</option>
                            <option value="255">赵姝</option>
                            <option value="261">唐昌琴</option>
                            <option value="276">徐誉琳</option>
                            <option value="278">钟亮</option>
                            <option value="280">沈若筠</option>
                            <option value="291">聂鹏程</option>
                            <option value="307">胡强强</option>
                            <option value="27">庄萌萌</option>
                            <option value="29">王辉祥</option>
                            <option value="141">网泰媒介</option>
                            <option value="303">邱寅婵</option>
                            <option value="252">蜀洲新月媒介</option>
                            <option value="254">蜀洲新越</option>
                            <option value="108">金瑞杰媒介</option>
                            <option value="50">陈周育</option>
                            <option value="134">范朝林</option>
                            <option value="140">谦博媒介</option>
                            <option value="185">鑫时空媒介(罗晓莉)</option>
                            <option value="37">唐丰嘉仪</option>
                            <option value="16">销售测试账号</option>
                            <option value="224">贾宁</option>
                            <option value="21">周艇皓</option>
                            <option value="19">李卫</option>
                            <option value="308">王锐</option>
                            <option value="271">周思维</option>
                            <option value="15">王宏宇</option>
                            <option value="325">地铁测试销售</option>
                        </select>
                    </div>*@
                    <div class="col-md-2 ui-sortable">
                        <div class="input-group date">
                            <input class="form-control" id="StartDate" name="StartDate" placeholder="起始日期">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="col-md-2 ui-sortable">
                        <div class="input-group date">
                            <input class="form-control" id="EndDate" name="EndDate" placeholder="截止日期">
                            <span class="input-group-addon"><i class="fa fa-calendar"></i></span>
                        </div>
                    </div>
                    <div class="col-sm-2 ui-sortable">
                        <div class="input-group">
                                <input type="button" class="btn btn-inverse" id="search" value="搜索">
                                <input type="button" class="btn btn-success m-l-10" id="export" value="导出Excel">
                        </div>
                    </div>
                </div>
        

            <div class="tab-pane fade active in" id="boardmap">
                <div id="container" style="min-width:400px;height:600px"></div>                
            </div>
            <div class="tab-pane fade" id="boardlist">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <!-- Search Begin -->
                        <!-- Search End -->
                        <div class="table-responsive">
                            <table class="table table-email" id="data-table-agreement">
                                <thead>
                                <tr>
                                    <th>名称</th>
                                    <th>支付总金额</th>
                                    <th>直签</th>
                                    <th>销售人员</th>
                                    <th>客户名称</th>
                                    <th>开始日期</th>
                                    <th>结束日期</th>
                                    <th>点位数量</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @*<tr class="gridrow">
                                        <td>青羊万达7月上</td>
                                        <td>144640</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>刘超</td>
                                        <td>成都青羊万达广场投资有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>33</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>华润</td>
                                        <td>645120</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>傅思棋</td>
                                        <td>北京益宏传媒广告有限公司</td>
                                        <td>2015/7/15 0:00:00</td>
                                        <td>2015/12/21 0:00:00</td>
                                        <td>198</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>天府汇城</td>
                                        <td>768150</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>庄萌萌</td>
                                        <td>成都人居置业有限公司 天府汇城</td>
                                        <td>2015/6/17 0:00:00</td>
                                        <td>2015/7/28 0:00:00</td>
                                        <td>291</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>万达广场</td>
                                        <td>153700</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>刘超</td>
                                        <td>成都青羊万达广场投资有限公司</td>
                                        <td>2015/7/15 0:00:00</td>
                                        <td>2015/7/16 0:00:00</td>
                                        <td>206</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>蓝光金悦金沙</td>
                                        <td>90000</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>周艇皓</td>
                                        <td>四川蓝光和骏实业有限公司</td>
                                        <td>2015/6/17 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>30</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>白马</td>
                                        <td>410465</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>傅思棋</td>
                                        <td>北京益宏传媒广告有限公司</td>
                                        <td>2015/6/5 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>129</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>友谊医院</td>
                                        <td>1306800</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>刘超</td>
                                        <td>成都册盟高新科技开发有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/9/14 0:00:00</td>
                                        <td>199</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>万科城</td>
                                        <td>154200</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>庄萌萌</td>
                                        <td>成都泰新房地产开发有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>30</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>花都财富项目</td>
                                        <td>122480</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>周艇皓</td>
                                        <td>成都星译投资有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>20</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>明宇启阳</td>
                                        <td>149400</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>周艇皓</td>
                                        <td>成都明宇环球文化传媒有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>30</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>世茂地产楼盘</td>
                                        <td>102400</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>周艇皓</td>
                                        <td>四川明阳广告有限公司</td>
                                        <td>2015/6/1 0:00:00</td>
                                        <td>2015/7/31 0:00:00</td>
                                        <td>33</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>美年达</td>
                                        <td>207600</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>王辉祥</td>
                                        <td>成都百事饮料有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>62</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>仁和春天国际广场</td>
                                        <td>1050900</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>徐志</td>
                                        <td>仁和春天房产（徐志代持）</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2015/12/28 0:00:00</td>
                                        <td>219</td>
                                    </tr>
                                    <tr class="gridrow_alternate">
                                        <td>北湖国际城</td>
                                        <td>425000</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>庄萌萌</td>
                                        <td>中国铁建房地产四川有限公司</td>
                                        <td>2015/7/1 0:00:00</td>
                                        <td>2016/1/28 0:00:00</td>
                                        <td>84</td>
                                    </tr>
                                    <tr class="gridrow">
                                        <td>凯德天府</td>
                                        <td>546560</td>
                                        <td>
                                            <i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>

                                        </td>
                                        <td>王辉祥</td>
                                        <td>成都华韵江南房地产开发有限公司</td>
                                        <td>2015/6/17 0:00:00</td>
                                        <td>2015/7/14 0:00:00</td>
                                        <td>97</td>
                                    </tr>*@
                                </tbody>
                            </table>
                        </div>
                        @*<div class="email-footer clearfix"><span class="hidden-sm hidden-xs">当前 1项 - 15项， 共 816 项</span><ul class="pagination m-t-0 m-b-0 pull-right"><li class="disabled"><a>首页</a></li><li class="disabled"><a>上一页</a></li><li class="active hidden-sm hidden-xs"><a>1</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=2">2</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=3">3</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=4">4</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=5">5</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=6">6</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=7">7</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=8">8</a></li><li class="hidden-sm hidden-xs"><a href="/zh-CN/AgreementStatistic?page=9">9</a></li><li><a href="/zh-CN/AgreementStatistic?page=2">下一页</a></li><li><a href="/zh-CN/AgreementStatistic?page=55">末页</a></li></ul></div>*@
                    </div>

                </div>
            </div>
        </div>

    </div>

    <!-- end col-12 -->

</div>

@section Scripts {
    @Scripts.Render("~/bundles/themes/sean/chart")
@Scripts.Render("~/Content/themes/sean/bootstrap-datepicker.js")
@Scripts.Render("~/Content/datatables/js/jquery.dataTables.js")
@Scripts.Render("~/Content/themes/sean/getCityAgentSaler.js")

    <script>
        $(document).ready(function () {
            $("#StartDate,#EndDate").datepicker({ autoclose: true, todayHighlight: true, format: "yyyy-mm", minView: 3 });
            renderChartAndTable();
            $("#export").click(function () {
                window.location.href = "/DF_Report/DownLoadAgreement?start="
                    + $("input#StartDate").val()
                    + "&end=" + $("input#EndDate").val()
                    + "&citycode=" + $("#City").val()
                + "&agent=" + $("#AgentId").val()
                + "&saler=" + $("#UserId").val();
            });
            $("#search").click(function () {
                renderChartAndTable();
            })
            $("#city-agent-containner").casDropdownList({ containerID: "city-agent-containner" });
        });

        function renderChartAndTable() {
            $.post("/Df_Report/GetAgreementData",
                {
                    start: $("input#StartDate").val(),
                    end: $("input#EndDate").val(),
                    citycode: $("#City").val(),
                    agent: $("#AgentId").val(),
                    saler: $("#UserId").val(),
                }, function (d) {
                    if (d.success) {                       
                        $('#container').highcharts({
                            chart: {
                                type: 'column'
                            },
                            title: {
                                text: '东方天呈交易统计'
                            },
                            subtitle: {
                                text: '统计确认单交易金额'
                            },
                            xAxis: {
                                categories: d.chartdata.Series,
                                crosshair: true
                            },
                            yAxis: {
                                min: 0,
                                title: {
                                    text: '交易金额 (万元)'
                                }
                            },
                            tooltip: {
                                headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
                                pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                                '<td style="padding:0"><b>{point.y:.3f} 万元</b></td></tr>',
                                footerFormat: '</table>',
                                shared: true,
                                useHTML: true
                            },
                            plotOptions: {
                                column: {
                                    pointPadding: 0.2,
                                    borderWidth: 0
                                }
                            },
                            series: [{
                                name: '总金额',                                
                                data: d.chartdata.TotalAmount ,
                                tooltip: {
                                    valueSuffix: ' 万元'
                                }
                            }]
                        });
                        $("#data-table-agreement").DataTable().destroy();
                        $("#data-table-agreement").DataTable({
                            "dom": "tip",
                            "pageLength": 15,
                            "lengthChange": false,
                            "ordering": true,
                            "data": d.tableData,
                            "columns": [
                                { "data": "Order.BrandDesc" },
                                { "data": "PayTotal" },
                                {
                                    "data": function (e) {
                                        switch (e.AgreementType) {
                                            case 1:
                                                return '<i class="fa fa-check-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>'
                                                break;
                                            case 2:
                                                return '<i class="fa fa-square text-success" data-toggle="tooltip" data-placement="right" data-original-title="" title=""></i>'
                                                break
                                            default:
                                                break;

                                        }
                                    }
                                },
                                { "data": "PublishName" },
                                { "data": "Order.CustomerName" },
                                {
                                    "data":
                                        function (e) {                                           
                                            return renderTime(e.Order.StartDate)    
                                        }
                                     
                                },
                                {
                                    "data":
                                          function (e) {                                            
                                              return renderTime(e.Order.EndDate)
                                          }
                                },
                                { "data": "Order.CustomerName" },
                               
                            ],
                            "info": true,
                            "bAutoWidth": false,
                            "pagingType": "full",
                            "searching": true,
                            language: {
                                //lengthMenu: '<select class="form-control input-xsmall">' + '<option value="5">5</option>' + '<option value="10">10</option>' + '<option value="20">20</option>' + '<option value="30">30</option>' + '<option value="40">40</option>' + '<option value="50">50</option>' + '</select>条记录',//左上角的分页大小显示。
                                processing: "载入中",//处理页面数据的时候的显示
                                paginate: {//分页的样式文本内容。
                                    previous: "上一页",
                                    next: "下一页",
                                    first: "第一页",
                                    last: "最后一页"
                                },

                                zeroRecords: "没有内容",//table tbody内容为空时，tbody的内容。
                                //下面三者构成了总体的左下角的内容。
                                info: "共_PAGES_ 页，显示第_START_ 到第 _END_ ，_TOTAL_ 项 ",//左下角的信息显示，大写的词为关键字。
                                infoEmpty: "0条记录",//筛选为空时左下角的显示。
                                infoFiltered: ""//筛选之后的左下角筛选提示(另一个是分页信息显示，在上面的info中已经设置，所以可以不显示)，
                            }
                        });
                    }

            })
        }

        

        function renderTime(date) {
            var da = new Date(parseInt(date.replace("/Date(", "").replace(")/", "").split("+")[0]));
            return da.getFullYear() + "-" + (da.getMonth() + 1) + "-" + da.getDate() + " " + da.getHours() + ":" + da.getSeconds() + ":" + da.getMinutes();
        }
    </script>
}