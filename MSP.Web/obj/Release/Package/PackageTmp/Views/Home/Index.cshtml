@{
    ViewBag.Title = "";
}
@section header{
@Styles.Render("~/Content/datatables/css/jquery.dataTables.css")
   <style>
       .media-list :hover{
           background-color:whitesmoke;
           cursor:pointer;
            *cursor: hand;
       }
    </style>
    }
<!-- begin row -->
<div class="row">
    <!-- begin col-3 -->
    <div class="col-md-3 col-sm-6">
        <div class="widget widget-stats bg-pink">
            <div class="stats-icon"><i class="material-icons">desktop_windows</i></div>
            <div class="stats-info">
                <h4>全国设备总数</h4>
                <p>291,922 台</p>
            </div>
            <div class="stats-link">
                <a href="javascript:;">查看详情 <i class="fa fa-arrow-circle-o-right"></i></a>
            </div>
        </div>
    </div>
    <!-- end col-3 -->
    <!-- begin col-3 -->
    <div class="col-md-3 col-sm-6">
        <div class="widget widget-stats bg-orange">
            <div class="stats-icon"><i class="material-icons">phonelink_erase</i></div>
            <div class="stats-info">
                <h4>当前可用率</h4>
                <p>89.44%</p>
            </div>
            <div class="stats-link">
                <a href="javascript:;">查看详情 <i class="fa fa-arrow-circle-o-right"></i></a>
            </div>
        </div>
    </div>
    <!-- end col-3 -->
    <!-- begin col-3 -->
    <div class="col-md-3 col-sm-6">
        <div class="widget widget-stats bg-grey-600">
            <div class="stats-icon"><i class="material-icons">people_outline</i></div>
            <div class="stats-info">
                <h4>当前报备客户数量</h4>
                <p>1,922</p>
            </div>
            <div class="stats-link">
                <a href="javascript:;">查看详情 <i class="fa fa-arrow-circle-o-right"></i></a>
            </div>
        </div>
    </div>
    <!-- end col-3 -->
    <!-- begin col-3 -->
    <div class="col-md-3 col-sm-6">
        <div class="widget widget-stats bg-red">
            <div class="stats-icon"><i class="material-icons">timer</i></div>
            <div class="stats-info">
                <h4>订单平均售卖时长</h4>
                <p>1795.2 小时</p>
            </div>
            <div class="stats-link">
                <a href="javascript:;">查看详情 <i class="fa fa-arrow-circle-o-right"></i></a>
            </div>
        </div>
    </div>
    <!-- end col-3 -->
</div>
<!-- end row -->

<!-- begin row -->
<div class="row">
    <div class="col-md-8">
        <div class="panel panel-inverse" data-sortable-id="index-5">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
                </div>
                <h4 class="panel-title">消息通知</h4>
            </div>
            <div class="panel-body">
                <div class="height-sm" data-scrollbar="true" id="message-container">
                    <table class="table table-hover " id="data-table-message">
                      
                    </table>             

                
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="panel panel-inverse" data-sortable-id="index-7">
            <div class="panel-heading">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
                </div>
                <h4 class="panel-title">客户订单行业分类</h4>
            </div>
            <div class="panel-body">
                <div id="container" class="height-sm"></div>
            </div>
        </div>
    </div>
</div>
<!-- end row -->

<!-- begin row -->
<div class="row">
    <div class="panel panel-inverse" data-sortable-id="index-1">
        <div class="panel-heading">
            <div class="panel-heading-btn">
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-repeat"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
            </div>
            <h4 class="panel-title">设备全国分布情况</h4>
        </div>
        <div class="panel-body">
            <div id="container2" class="height-sm"></div>
        </div>
    </div>
</div>
<!-- end row -->

<div class="modal fade" id="modal-alert">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title">Alert Header</h4>
            </div>
            <div class="modal-body">
                <div id="con_news_c" style="margin-bottom:30px;">
                    <div id="con_news_c_title">
                        <h2>地图选择方式变更</h2>
                        <h3>发布时间:2016/10/18 15:18:41 &nbsp;&nbsp;分类:版本更新 &nbsp;&nbsp;发布人:平台媒介管理员</h3>
                    </div>
                    <div id="Content">
                        <p>即日起， 由于版权问题， 公交候车亭地图选点的方式一律改成高德地图。 如果各位在使用过程中发现任何与原始百度地图使用的差异，或者BUG问题， 请及时联系我们！！！</p>
                    </div>
                    <div id="Files" style="border-top: 1px dashed #CCCCCC;">
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts {    
    @Scripts.Render("~/bundles/themes/sean/chart")
   @Scripts.Render("~/Content/datatables/js/jquery.dataTables.js")
   

    <script>
        $(document).ready(function () {
            $('#container').highcharts({
                chart: {
                    plotBackgroundColor: null,
                    plotBorderWidth: null,
                    plotShadow: false
                },
                title: {
                    text: null
                },
                tooltip: {
                    pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
                },
                plotOptions: {
                    pie: {
                        allowPointSelect: true,
                        cursor: 'pointer',
                        dataLabels: {
                            enabled: false
                        },
                        showInLegend: true
                    }
                },
                series: [{
                    type: 'pie',
                    name: '订单占比',
                    data: [
                        ['4A（FA）', 45.0],
                        ['房地产', 26.8],
                        {
                            name: '家居卖场',
                            y: 12.8,
                            sliced: true,
                            selected: true
                        },
                        ['医疗美容', 8.5],
                        ['快消品', 6.2],
                        ['其他', 0.7]
                    ]
                }]
            });

            $('#container2').highcharts({
                chart: {
                    type: 'column'
                },
                title: {
                    text: null
                },
                xAxis: {
                    type: 'category'
                },
                yAxis: {
                    title: {
                        text: '总计部署设备数量'
                    }
                },
                legend: {
                    enabled: false
                },
                plotOptions: {
                    series: {
                        borderWidth: 0,
                        dataLabels: {
                            enabled: true
                        }
                    }
                },
                tooltip: {
                    pointFormat: '<span style="color:{point.color}">{point.name}</span>: <b>{point.y:.2f}%</b> of total<br/>'
                },
                series: [{
                    name: 'Brands',
                    data: [
                        ['上海', 23.7],
                        ['Lagos', 16.1],
                        ['Instanbul', 14.2],
                        ['Karachi', 14.0],
                        ['Mumbai', 12.5],
                        ['Moscow', 12.1],
                        ['São Paulo', 11.8],
                        ['Beijing', 11.7],
                        ['Guangzhou', 11.1],
                        ['Delhi', 11.1],
                        ['Shenzhen', 10.5],
                        ['Seoul', 10.4],
                        ['Jakarta', 10.0],
                        ['Kinshasa', 9.3],
                        ['Tianjin', 9.3],
                        ['Tokyo', 9.0],
                        ['Cairo', 8.9],
                        ['Dhaka', 8.9],
                        ['Mexico City', 8.9],
                        ['Lima', 8.9]
                    ],
                }]
            });


            $.post("/NoteMessageBase/Get", { mediaType: 1, page: 1 }, function (d) {
                if (d.success) {                    
                    var data = d.data;
                    
                    //$("#data-table-message").DataTable().destroy();
               
                    $("#data-table-message").DataTable(
                        {
                            "headerCallback": function( thead, data, start, end, display ) {
                                $(thead)/*.find('th').eq(0)*/.css( 'height',"0px" );},
                            "dom": "tip",
                            "pageLength": 4,
                            "scrollX": false,
                            "lengthChange": false,
                            "ordering": true,
                            "data": d.data,
                            "columns": [
                               
                                {
                                    "data": function (e) {
                                        //var cont = $(' <span class="fa-stack fa-2x text-success pull-left m-r-30"><i class="fa fa-circle fa-stack-2x"></i>');
                                        switch (e["Type"]) {
                                            case 0:
                                                return ' <span class="fa-stack fa-2x text-success pull-left m-r-30"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-flag fa-stack-1x fa-inverse"></i> </span>'
                                               
                                                break;
                                            case 1:
                                                return ' <span class="fa-stack fa-2x text-success pull-left m-r-30"><i class="fa fa-circle fa-stack-2x"></i> <i class="fa fa-cog fa-stack-1x fa-inverse"></i> </span>'
                                                //$('<i class="fa fa-cog fa-stack-1x fa-inverse"></i> </span>').appendTo(cont);
                                                break;
                                            default:
                                                return '';
                                                break;

                                        }
                                        

                                    }
                                },
                                {
                                    "data": function (e) {
                                        return '<div class="media-body" onclick="openMessage('+e["Id"] + ')">'+
                                        '<h5 class="media-heading">' + e["Title"] + '</h5>' +
                                        '<p>' + e["Content"] + '</p> </div>';
                                    }
                                }
                            ],
                            "info": true,
                            "bAutoWidth": false,
                            "pagingType": "full",
                            "searching": true,
                            language: {
                                //lengthMenu: '<select class="form-control input-xsmall">' + '<option value="5">5</option>' + '<option value="10">10</option>' + '<option value="20">20</option>' + '<option value="30">30</option>' + '<option value="40">40</option>' + '<option value="50">50</option>' + '</select>条记录',//左上角的分页大小显示。
                                processing: "载入中",//处理页面数据的时候的显示
                                paginate: {//分页的样式文本内容。
                                    previous: "上一页",
                                    next: "下一页",
                                    first: "第一页",
                                    last: "最后一页"
                                },

                                zeroRecords: "没有内容",//table tbody内容为空时，tbody的内容。
                                //下面三者构成了总体的左下角的内容。
                                info: "共_PAGES_ 页，显示第_START_ 到第 _END_ ，_TOTAL_ 项 ",//左下角的信息显示，大写的词为关键字。
                                infoEmpty: "0条记录",//筛选为空时左下角的显示。
                                infoFiltered: ""//筛选之后的左下角筛选提示(另一个是分页信息显示，在上面的info中已经设置，所以可以不显示)，
                            }
                           
                        })
                    

                }

            })
        });

        function openMessage(id)
        {
            $.post("/NoteMessageBase/GetContent", { id: id }, function (d) {
                if (d.success) {
                    var content = d.data;
                    $("#modal-alert .modal-body").empty();

                    var htmlcontent= $('  <div id="con_news_c" style="margin-bottom:30px;">'+
                    '<div id="con_news_c_title">'+
                        '<h2>' + content.Title + '</h2>' +
                        '<h3>发布时间: ' +renderTime( content.CreateTime) + ' &nbsp;&nbsp;分类: ' + content.TypeName + '&nbsp;&nbsp;发布人:' + content.UserName + '</h3>' +
                   ' </div>'+
                    '<div id="Content">' + content.Content + ' </div> ');
                 
                    if (content.Files.length > 0) {
                        var files = $('<div id="Files" style="border-top: 1px dashed #CCCCCC;"> </div>');
                        for (var i = 0; i < content.Files.length; i++) {
                            $('<span style="color:cornflowerblue;line-height:30px;">' + content.Files[i].FileName + '<a class="email-btn" href="/NoteMessageBase/DownLoad/' + content.Files[i].Id + '">' +
                                '<i class="fa fa-download"></i></a></span><br />').appendTo(files);

                        }
                        files.appendTo(htmlcontent);
                         

                    }
                    $('  </div>').appendTo(htmlcontent);
                    htmlcontent.appendTo($("#modal-alert .modal-body"));

                }

            });
            $('#modal-alert').modal('show');
        }
        //function renderContent(data) {
        //    $("#note-message-list").empty();
        //    if (data.length>0) {
        //        for (var i = 0; i < data.length; i++) {
        //            var m = data[i];
        //            if (m) {
        //                var message = $('<li class="media media-sm"></li>');
        //                switch (m.Type) {
        //                    case 0:
        //                        $('<span class="fa-stack fa-2x text-warning pull-left m-r-30">' +
        //                        ' <i class="fa fa-circle-o fa-stack-2x"></i>' +
        //                        ' <i class="fa fa-cog fa-stack-1x"></i>  </span>').appendTo(message);
        //                        break;
        //                    case 1:
        //                        $('<span class="fa-stack fa-2x text-success pull-left m-r-30">' +
        //                        ' <i class="fa fa-circle-o fa-stack-2x"></i>' +
        //                        ' <i class="fa fa-flag fa-stack-1x"></i>  </span>').appendTo(message);
        //                        break;
        //                    default:
        //                        break;
        //                }

        //                $('<div class="media-body" onclick="openMessage(' + m.Id + ')">' +
        //                    '<h5 class="media-heading">' + m.Title + '</h5>' +
        //                    '<p>' + m.Content + '</p>' +
        //                '</div>').appendTo(message);
        //                message.appendTo($("#note-message-list"));

        //            }


        //        }
        //    }
        //    return $("#note-message-list").html();

        //}
        function renderTime(date) {
            var da = new Date(parseInt(date.replace("/Date(", "").replace(")/", "").split("+")[0]));
            return da.getFullYear() + "-" + (da.getMonth() + 1) + "-" + da.getDate() + " " + da.getHours() + ":" + da.getSeconds() + ":" + da.getMinutes();
        }
    </script>
}